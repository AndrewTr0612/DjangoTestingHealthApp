{% extends 'base.html' %}

{% block title %}Set Goal - Health Tracker{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-10 col-lg-8">
        <div class="card shadow-lg">
            <div class="card-header text-white" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">
                <h3 class="mb-0">
                    <i class="bi bi-target"></i> {% if is_new %}Set Your Weight Goal{% else %}Update Weight Goal{% endif %}
                </h3>
                <small class="opacity-75">Define your target and track your progress</small>
            </div>
            <div class="card-body p-4">
                {% if latest_weight %}
                <div class="alert alert-info mb-4">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h6 class="mb-1"><i class="bi bi-info-circle"></i> Current Status</h6>
                            <p class="mb-0">Your current weight is <strong>{{ latest_weight.weight_kg|floatformat:1 }} kg</strong> 
                            {% if latest_weight.bmi %}with a BMI of <strong>{{ latest_weight.bmi }}</strong> ({{ latest_weight.bmi_category }}){% endif %}</p>
                        </div>
                        <div class="col-md-4 text-md-end mt-2 mt-md-0">
                            <span class="badge bg-primary" style="font-size: 1.2rem; padding: 0.5rem 1rem;">
                                {{ latest_weight.weight_kg|floatformat:1 }} kg
                            </span>
                        </div>
                    </div>
                </div>
                {% endif %}

                {% if suggestions %}
                <div class="alert alert-success mb-4">
                    <h6 class="mb-3"><i class="bi bi-lightbulb-fill"></i> Weight Goal Suggestions</h6>
                    
                    <div class="row g-2 mb-3">
                        <div class="col-md-6">
                            <div class="card bg-light">
                                <div class="card-body py-2">
                                    <small class="text-muted d-block">Healthy Weight Range</small>
                                    <strong>{{ suggestions.min_healthy }} - {{ suggestions.max_healthy }} kg</strong>
                                    <small class="text-muted d-block">(BMI 18.5 - 24.9)</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card bg-light">
                                <div class="card-body py-2">
                                    <small class="text-muted d-block">Ideal Weight</small>
                                    <strong>{{ suggestions.ideal_weight }} kg</strong>
                                    <small class="text-muted d-block">(BMI 22.0)</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row g-2">
                        <div class="col-6 col-md-3">
                            <button type="button" class="btn btn-sm btn-outline-danger w-100 goal-suggestion" data-weight="{{ suggestions.lose_moderate }}">
                                <small>Lose 5kg</small><br>
                                <strong>{{ suggestions.lose_moderate }} kg</strong>
                            </button>
                        </div>
                        <div class="col-6 col-md-3">
                            <button type="button" class="btn btn-sm btn-outline-danger w-100 goal-suggestion" data-weight="{{ suggestions.lose_significant }}">
                                <small>Lose 10kg</small><br>
                                <strong>{{ suggestions.lose_significant }} kg</strong>
                            </button>
                        </div>
                        <div class="col-6 col-md-3">
                            <button type="button" class="btn btn-sm btn-outline-success w-100 goal-suggestion" data-weight="{{ suggestions.gain_moderate }}">
                                <small>Gain 3kg</small><br>
                                <strong>{{ suggestions.gain_moderate }} kg</strong>
                            </button>
                        </div>
                        <div class="col-6 col-md-3">
                            <button type="button" class="btn btn-sm btn-outline-success w-100 goal-suggestion" data-weight="{{ suggestions.gain_significant }}">
                                <small>Gain 5kg</small><br>
                                <strong>{{ suggestions.gain_significant }} kg</strong>
                            </button>
                        </div>
                    </div>
                    <small class="text-muted mt-2 d-block"><i class="bi bi-info-circle"></i> Click a suggestion to use it as your target weight</small>
                </div>
                {% endif %}

                <form method="post">
                    {% csrf_token %}
                    
                    <div class="row">
                        <div class="col-md-6 mb-4">
                            <label for="{{ form.goal_type.id_for_label }}" class="form-label fw-bold">
                                <i class="bi bi-arrow-up-down text-primary"></i> Goal Type
                            </label>
                            {{ form.goal_type }}
                            <div class="form-text">
                                <i class="bi bi-lightbulb"></i> What do you want to achieve?
                            </div>
                            {% for error in form.goal_type.errors %}
                            <div class="alert alert-danger mt-2 py-2">{{ error }}</div>
                            {% endfor %}
                        </div>

                        <div class="col-md-6 mb-4">
                            <label for="{{ form.target_weight_kg.id_for_label }}" class="form-label fw-bold">
                                <i class="bi bi-bullseye text-success"></i> Target Weight (kg)
                            </label>
                            {{ form.target_weight_kg }}
                            <div class="form-text">
                                <i class="bi bi-info-circle"></i> Your desired weight in kilograms
                            </div>
                            {% for error in form.target_weight_kg.errors %}
                            <div class="alert alert-danger mt-2 py-2">{{ error }}</div>
                            {% endfor %}
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-4">
                            <label for="{{ form.pace.id_for_label }}" class="form-label fw-bold">
                                <i class="bi bi-speedometer text-warning"></i> Pace
                            </label>
                            {{ form.pace }}
                            <div class="form-text">
                                <i class="bi bi-info-circle"></i> How fast do you want to reach your goal?
                            </div>
                            <div class="mt-2">
                                <small class="text-muted d-block"><strong>Slow:</strong> 0.3 kg/week - Sustainable & healthy</small>
                                <small class="text-muted d-block"><strong>Moderate:</strong> 0.5 kg/week - Balanced approach</small>
                                <small class="text-muted d-block"><strong>Fast:</strong> 1.0 kg/week - Aggressive but achievable</small>
                            </div>
                            {% for error in form.pace.errors %}
                            <div class="alert alert-danger mt-2 py-2">{{ error }}</div>
                            {% endfor %}
                        </div>

                        <div class="col-md-6 mb-4">
                            <label for="{{ form.start_date.id_for_label }}" class="form-label fw-bold">
                                <i class="bi bi-calendar-event text-info"></i> Start Date
                            </label>
                            {{ form.start_date }}
                            <div class="form-text">
                                <i class="bi bi-info-circle"></i> When does your journey begin?
                            </div>
                            {% for error in form.start_date.errors %}
                            <div class="alert alert-danger mt-2 py-2">{{ error }}</div>
                            {% endfor %}
                        </div>
                    </div>

                    <div class="alert alert-light border">
                        <h6><i class="bi bi-calculator"></i> Goal Calculator Preview</h6>
                        <p class="small mb-0 text-muted">
                            After you set your goal, we'll calculate your estimated timeline, target date, and track your progress automatically!
                        </p>
                    </div>

                    <div class="d-grid gap-2 mt-4">
                        <button type="submit" class="btn btn-success btn-lg">
                            <i class="bi bi-check-circle"></i> {% if is_new %}Set My Goal{% else %}Update Goal{% endif %}
                        </button>
                        <a href="{% url 'accounts:dashboard' %}" class="btn btn-outline-secondary">
                            <i class="bi bi-arrow-left"></i> Back to Dashboard
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
// Handle weight suggestion button clicks
document.addEventListener('DOMContentLoaded', function() {
    const suggestionButtons = document.querySelectorAll('.goal-suggestion');
    const targetWeightInput = document.getElementById('{{ form.target_weight_kg.id_for_label }}');
    
    suggestionButtons.forEach(button => {
        button.addEventListener('click', function() {
            const weight = this.getAttribute('data-weight');
            if (targetWeightInput && weight) {
                targetWeightInput.value = weight;
                
                // Visual feedback
                suggestionButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                
                // Smooth scroll to the target weight field
                targetWeightInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
                targetWeightInput.focus();
            }
        });
    });
});
</script>
{% endblock %}
